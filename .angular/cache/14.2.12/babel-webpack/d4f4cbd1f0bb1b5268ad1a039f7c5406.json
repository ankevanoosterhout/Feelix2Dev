{"ast":null,"code":"/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\nimport { ResizeBilinearGrad, util } from '@tensorflow/tfjs-core';\nimport { assertNotComplex } from '../cpu_util';\nexport function resizeBilinearGrad(args) {\n  const {\n    inputs,\n    backend,\n    attrs\n  } = args;\n  const {\n    images,\n    dy\n  } = inputs;\n  const {\n    alignCorners\n  } = attrs;\n  assertNotComplex([dy, images], 'resizeBilinearGrad');\n  const imagesStrides = util.computeStrides(images.shape);\n  const [batch, xHeight, xWidth, depth] = images.shape;\n  const [, yHeight, yWidth] = dy.shape;\n  const output = new Float32Array(batch * xHeight * xWidth * depth); // In the backwards pass, we want to find the pixels that were generated\n  // for each pixel in the input image the forward pass and add the\n  // corresponding coefficient from dy to the gradient (with some\n  // interpolation).\n\n  const effectiveXSize = [alignCorners && yHeight > 1 ? xHeight - 1 : xHeight, alignCorners && yWidth > 1 ? xWidth - 1 : xWidth];\n  const effectiveYSize = [alignCorners && yHeight > 1 ? yHeight - 1 : yHeight, alignCorners && yWidth > 1 ? yWidth - 1 : yWidth];\n  const heightScale = effectiveXSize[0] / effectiveYSize[0];\n  const widthScale = effectiveXSize[1] / effectiveYSize[1]; // Reference implementation\n  // tslint:disable-next-line:max-line-length\n  // https://github.com/tensorflow/tensorflow/blob/3039375c86a5bbc9610c7725dcaa95d635f87ba2/tensorflow/core/kernels/resize_bilinear_op.cc#L275\n\n  const dyValues = backend.data.get(dy.dataId).values;\n  let offset = 0;\n\n  for (let b = 0; b < batch; b++) {\n    const bOffset = b * imagesStrides[0];\n\n    for (let r = 0; r < yHeight; r++) {\n      const dxR = r * heightScale;\n      const topDxRIndex = Math.floor(dxR);\n      const bottomDxRIndex = Math.min(Math.ceil(dxR), xHeight - 1);\n      const topDxROffset = bOffset + topDxRIndex * imagesStrides[1];\n      const bottomDxROffset = bOffset + bottomDxRIndex * imagesStrides[1];\n      const dxRLerp = dxR - topDxRIndex;\n      const inverseDxRLerp = 1.0 - dxRLerp;\n\n      for (let c = 0; c < yWidth; c++) {\n        const dxC = c * widthScale;\n        const leftDxCIndex = Math.floor(dxC);\n        const rightDxCIndex = Math.min(Math.ceil(dxC), xWidth - 1);\n        const dxCLerp = dxC - leftDxCIndex;\n        const inverseDxCLerp = 1.0 - dxCLerp;\n        const topLeftRCOffset = topDxROffset + leftDxCIndex * imagesStrides[2];\n        const topRightRCOffset = topDxROffset + rightDxCIndex * imagesStrides[2];\n        const bottomLeftRCOffset = bottomDxROffset + leftDxCIndex * imagesStrides[2];\n        const bottomRightRCOffset = bottomDxROffset + rightDxCIndex * imagesStrides[2];\n        const inverseDxRLerpTimesInverseDxCLerp = inverseDxRLerp * inverseDxCLerp;\n        const inverseDxRLerpTimesDxCLerp = inverseDxRLerp * dxCLerp;\n        const dxRLerpTimesInverseDxCLerp = dxRLerp * inverseDxCLerp;\n        const dxRLerpTimesDxCLerp = dxRLerp * dxCLerp;\n\n        for (let d = 0; d < depth; d++) {\n          const dyVal = dyValues[offset++];\n          output[topLeftRCOffset + d] += dyVal * inverseDxRLerpTimesInverseDxCLerp;\n          output[topRightRCOffset + d] += dyVal * inverseDxRLerpTimesDxCLerp;\n          output[bottomLeftRCOffset + d] += dyVal * dxRLerpTimesInverseDxCLerp;\n          output[bottomRightRCOffset + d] += dyVal * dxRLerpTimesDxCLerp;\n        }\n      }\n    }\n  }\n\n  return backend.makeTensorInfo([batch, xWidth, xHeight, depth], 'float32', output);\n}\nexport const resizeBilinearGradConfig = {\n  kernelName: ResizeBilinearGrad,\n  backendName: 'cpu',\n  kernelFunc: resizeBilinearGrad\n};","map":{"version":3,"names":["ResizeBilinearGrad","util","assertNotComplex","resizeBilinearGrad","args","inputs","backend","attrs","images","dy","alignCorners","imagesStrides","computeStrides","shape","batch","xHeight","xWidth","depth","yHeight","yWidth","output","Float32Array","effectiveXSize","effectiveYSize","heightScale","widthScale","dyValues","data","get","dataId","values","offset","b","bOffset","r","dxR","topDxRIndex","Math","floor","bottomDxRIndex","min","ceil","topDxROffset","bottomDxROffset","dxRLerp","inverseDxRLerp","c","dxC","leftDxCIndex","rightDxCIndex","dxCLerp","inverseDxCLerp","topLeftRCOffset","topRightRCOffset","bottomLeftRCOffset","bottomRightRCOffset","inverseDxRLerpTimesInverseDxCLerp","inverseDxRLerpTimesDxCLerp","dxRLerpTimesInverseDxCLerp","dxRLerpTimesDxCLerp","d","dyVal","makeTensorInfo","resizeBilinearGradConfig","kernelName","backendName","kernelFunc"],"sources":["C:/Users/Anke/Documents/Feelix documents/Feelix2.0-dev/Feelix v2/node_modules/@tensorflow/tfjs-backend-cpu/dist/kernels/ResizeBilinearGrad.js"],"sourcesContent":["/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\nimport { ResizeBilinearGrad, util } from '@tensorflow/tfjs-core';\nimport { assertNotComplex } from '../cpu_util';\nexport function resizeBilinearGrad(args) {\n    const { inputs, backend, attrs } = args;\n    const { images, dy } = inputs;\n    const { alignCorners } = attrs;\n    assertNotComplex([dy, images], 'resizeBilinearGrad');\n    const imagesStrides = util.computeStrides(images.shape);\n    const [batch, xHeight, xWidth, depth] = images.shape;\n    const [, yHeight, yWidth] = dy.shape;\n    const output = new Float32Array(batch * xHeight * xWidth * depth);\n    // In the backwards pass, we want to find the pixels that were generated\n    // for each pixel in the input image the forward pass and add the\n    // corresponding coefficient from dy to the gradient (with some\n    // interpolation).\n    const effectiveXSize = [\n        (alignCorners && yHeight > 1) ? xHeight - 1 : xHeight,\n        (alignCorners && yWidth > 1) ? xWidth - 1 : xWidth\n    ];\n    const effectiveYSize = [\n        (alignCorners && yHeight > 1) ? yHeight - 1 : yHeight,\n        (alignCorners && yWidth > 1) ? yWidth - 1 : yWidth\n    ];\n    const heightScale = effectiveXSize[0] / effectiveYSize[0];\n    const widthScale = effectiveXSize[1] / effectiveYSize[1];\n    // Reference implementation\n    // tslint:disable-next-line:max-line-length\n    // https://github.com/tensorflow/tensorflow/blob/3039375c86a5bbc9610c7725dcaa95d635f87ba2/tensorflow/core/kernels/resize_bilinear_op.cc#L275\n    const dyValues = backend.data.get(dy.dataId).values;\n    let offset = 0;\n    for (let b = 0; b < batch; b++) {\n        const bOffset = b * imagesStrides[0];\n        for (let r = 0; r < yHeight; r++) {\n            const dxR = r * heightScale;\n            const topDxRIndex = Math.floor(dxR);\n            const bottomDxRIndex = Math.min(Math.ceil(dxR), xHeight - 1);\n            const topDxROffset = bOffset + topDxRIndex * imagesStrides[1];\n            const bottomDxROffset = bOffset + bottomDxRIndex * imagesStrides[1];\n            const dxRLerp = dxR - topDxRIndex;\n            const inverseDxRLerp = 1.0 - dxRLerp;\n            for (let c = 0; c < yWidth; c++) {\n                const dxC = c * widthScale;\n                const leftDxCIndex = Math.floor(dxC);\n                const rightDxCIndex = Math.min(Math.ceil(dxC), xWidth - 1);\n                const dxCLerp = dxC - leftDxCIndex;\n                const inverseDxCLerp = 1.0 - dxCLerp;\n                const topLeftRCOffset = topDxROffset + leftDxCIndex * imagesStrides[2];\n                const topRightRCOffset = topDxROffset + rightDxCIndex * imagesStrides[2];\n                const bottomLeftRCOffset = bottomDxROffset + leftDxCIndex * imagesStrides[2];\n                const bottomRightRCOffset = bottomDxROffset + rightDxCIndex * imagesStrides[2];\n                const inverseDxRLerpTimesInverseDxCLerp = inverseDxRLerp * inverseDxCLerp;\n                const inverseDxRLerpTimesDxCLerp = inverseDxRLerp * dxCLerp;\n                const dxRLerpTimesInverseDxCLerp = dxRLerp * inverseDxCLerp;\n                const dxRLerpTimesDxCLerp = dxRLerp * dxCLerp;\n                for (let d = 0; d < depth; d++) {\n                    const dyVal = dyValues[offset++];\n                    output[topLeftRCOffset + d] +=\n                        dyVal * inverseDxRLerpTimesInverseDxCLerp;\n                    output[topRightRCOffset + d] += dyVal * inverseDxRLerpTimesDxCLerp;\n                    output[bottomLeftRCOffset + d] += dyVal * dxRLerpTimesInverseDxCLerp;\n                    output[bottomRightRCOffset + d] += dyVal * dxRLerpTimesDxCLerp;\n                }\n            }\n        }\n    }\n    return backend.makeTensorInfo([batch, xWidth, xHeight, depth], 'float32', output);\n}\nexport const resizeBilinearGradConfig = {\n    kernelName: ResizeBilinearGrad,\n    backendName: 'cpu',\n    kernelFunc: resizeBilinearGrad\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}