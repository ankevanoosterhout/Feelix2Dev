{"ast":null,"code":"import { mat4, vec3 } from 'gl-matrix';\nimport { Group, Matrix4 } from 'three';\nimport { Line2 } from 'three/examples/jsm/lines/Line2.js';\nconst glTempPos = new Float64Array(3);\nconst glTempMatrix = new Float64Array(16);\nconst tempMatrix = new Matrix4();\nconst tempParentMatrixWorld = new Matrix4();\nexport class IKLinkHelper extends Group {\n  constructor(link) {\n    super();\n    this.frame = link;\n    const line = new Line2();\n    line.geometry.setPositions([0, 0, 0, 0, 0, 0]);\n    line.material.color.set(0xffffff);\n    line.material.linewidth = 2;\n    this.add(line);\n    this.line = line;\n  }\n\n  update() {\n    const {\n      frame,\n      line\n    } = this;\n\n    if (frame.parent) {\n      glTempPos[0] = 0;\n      glTempPos[1] = 0;\n      glTempPos[2] = 0;\n      mat4.invert(glTempMatrix, frame.matrix);\n      vec3.transformMat4(glTempPos, glTempPos, glTempMatrix);\n      line.geometry.setPositions([...glTempPos, 0, 0, 0]);\n      line.visible = true;\n\n      if (vec3.length(glTempPos) < 1e-7) {\n        line.visible = false;\n      }\n    } else {\n      line.visible = false;\n    }\n  }\n\n  updateMatrixWorld(...args) {\n    const frame = this.frame;\n    frame.updateMatrixWorld();\n\n    if (frame.isJoint) {\n      if (frame.parent) {\n        tempMatrix.set(...frame.matrix).transpose();\n        tempParentMatrixWorld.set(...frame.parent.matrixWorld).transpose();\n        this.matrix.multiplyMatrices(tempParentMatrixWorld, tempMatrix);\n      } else {\n        tempMatrix.set(...frame.matrix).transpose();\n        this.matrix.set(...frame.matrix).transpose();\n      }\n    } else {\n      this.matrix.set(...frame.matrixWorld).transpose();\n    }\n\n    this.matrix.decompose(this.position, this.quaternion, this.scale);\n    super.updateMatrixWorld(...args);\n  }\n\n  dispose() {\n    this.traverse(c => {\n      if (c.material) {\n        c.material.dispose();\n      }\n\n      if (c.geometry) {\n        c.geometry.dispose();\n      }\n    });\n  }\n\n}","map":{"version":3,"names":["mat4","vec3","Group","Matrix4","Line2","glTempPos","Float64Array","glTempMatrix","tempMatrix","tempParentMatrixWorld","IKLinkHelper","constructor","link","frame","line","geometry","setPositions","material","color","set","linewidth","add","update","parent","invert","matrix","transformMat4","visible","length","updateMatrixWorld","args","isJoint","transpose","matrixWorld","multiplyMatrices","decompose","position","quaternion","scale","dispose","traverse","c"],"sources":["C:/Users/Anke/Documents/Feelix documents/Feelix2.0-dev/Feelix v2/node_modules/closed-chain-ik/src/three/IKLinkHelper.js"],"sourcesContent":["import { mat4, vec3 } from 'gl-matrix';\r\nimport { Group, Matrix4 } from 'three';\r\nimport { Line2 } from 'three/examples/jsm/lines/Line2.js';\r\n\r\nconst glTempPos = new Float64Array( 3 );\r\nconst glTempMatrix = new Float64Array( 16 );\r\nconst tempMatrix = new Matrix4();\r\nconst tempParentMatrixWorld = new Matrix4();\r\nexport class IKLinkHelper extends Group {\r\n\r\n\tconstructor( link ) {\r\n\r\n\t\tsuper();\r\n\t\tthis.frame = link;\r\n\r\n\t\tconst line = new Line2();\r\n\t\tline.geometry.setPositions( [\r\n\t\t\t0, 0, 0,\r\n\t\t\t0, 0, 0,\r\n\t\t] );\r\n\t\tline.material.color.set( 0xffffff );\r\n\t\tline.material.linewidth = 2;\r\n\t\tthis.add( line );\r\n\t\tthis.line = line;\r\n\r\n\t}\r\n\r\n\tupdate() {\r\n\r\n\t\tconst { frame, line } = this;\r\n\t\tif ( frame.parent ) {\r\n\r\n\t\t\tglTempPos[ 0 ] = 0;\r\n\t\t\tglTempPos[ 1 ] = 0;\r\n\t\t\tglTempPos[ 2 ] = 0;\r\n\r\n\t\t\tmat4.invert( glTempMatrix, frame.matrix );\r\n\t\t\tvec3.transformMat4( glTempPos, glTempPos, glTempMatrix );\r\n\r\n\t\t\tline.geometry.setPositions( [\r\n\t\t\t\t...glTempPos,\r\n\t\t\t\t0, 0, 0,\r\n\t\t\t] );\r\n\t\t\tline.visible = true;\r\n\r\n\t\t\tif ( vec3.length( glTempPos ) < 1e-7 ) {\r\n\r\n\t\t\t\tline.visible = false;\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tline.visible = false;\r\n\r\n\t\t}\r\n\r\n\r\n\t}\r\n\r\n\tupdateMatrixWorld( ...args ) {\r\n\r\n\t\tconst frame = this.frame;\r\n\t\tframe.updateMatrixWorld();\r\n\t\tif ( frame.isJoint ) {\r\n\r\n\t\t\tif ( frame.parent ) {\r\n\r\n\t\t\t\ttempMatrix.set( ...frame.matrix ).transpose();\r\n\t\t\t\ttempParentMatrixWorld.set( ...frame.parent.matrixWorld ).transpose();\r\n\t\t\t\tthis.matrix.multiplyMatrices( tempParentMatrixWorld, tempMatrix );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\ttempMatrix.set( ...frame.matrix ).transpose();\r\n\t\t\t\tthis.matrix.set( ...frame.matrix ).transpose();\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tthis.matrix.set( ...frame.matrixWorld ).transpose();\r\n\r\n\t\t}\r\n\r\n\t\tthis.matrix.decompose( this.position, this.quaternion, this.scale );\r\n\t\tsuper.updateMatrixWorld( ...args );\r\n\r\n\t}\r\n\r\n\tdispose() {\r\n\r\n\t\tthis.traverse( c => {\r\n\r\n\t\t\tif ( c.material ) {\r\n\r\n\t\t\t\tc.material.dispose();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( c.geometry ) {\r\n\r\n\t\t\t\tc.geometry.dispose();\r\n\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}